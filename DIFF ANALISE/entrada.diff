+async function patchCpfStatusIfChanged(cpfKey, nextStatus, vendedorAtual = "Outros") {
+  try {
+    const existing = await readCpfStatus(cpfKey).catch(() => null); // { status, vendedor, ... } | null
+    const before = existing?.status ? JSON.stringify(existing.status) : null;
+    const after  = nextStatus ? JSON.stringify(nextStatus) : null;
+    const changed = before !== after;
+    if (changed) {
+      await upsertCpfStatusByCpf(cpfKey, nextStatus, vendedorAtual);
+    }
+    return { changed, before: existing?.status ?? null, after: nextStatus };
+  } catch (e) {
+    // propaga para o caller lidar no contador de erros
+    throw e;
+  }
+}